<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Insurance CRM</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Inter', sans-serif; 
      -webkit-font-smoothing: antialiased;
    }
    .tab-active { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    .modal { 
      display: none; 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      z-index: 50; 
      animation: fadeIn 0.2s ease;
    }
    .modal.active { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
    }
    .modal-content {
      animation: slideUp 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideUp {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .card {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.08);
    }
    .badge { 
      font-size: 0.7rem; 
      padding: 0.3rem 0.65rem; 
      border-radius: 20px; 
      font-weight: 600;
      letter-spacing: 0.3px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
    }
    .btn-primary:hover {
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
      transform: translateY(-2px);
    }
    .btn-call {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      transition: all 0.3s ease;
    }
    .btn-call:hover {
      box-shadow: 0 8px 16px rgba(16, 185, 129, 0.4);
      transform: translateY(-2px);
    }
    .btn-whatsapp {
      background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
      transition: all 0.3s ease;
    }
    .btn-whatsapp:hover {
      box-shadow: 0 8px 16px rgba(37, 211, 102, 0.4);
      transform: translateY(-2px);
    }
    .glass-effect {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">

  <!-- Header -->
  <header class="glass-effect shadow-sm sticky top-0 z-40 border-b border-gray-200">
    <div class="px-5 py-4">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-xl gradient-bg flex items-center justify-center text-white text-xl">
          üè•
        </div>
        <div>
          <h1 class="text-xl font-bold text-gray-800">Insurance CRM</h1>
          <p class="text-xs text-gray-500 font-light">Care Supreme - Policy Management</p>
        </div>
      </div>
    </div>
    
    <!-- Tabs -->
    <div class="flex gap-2 px-4 pb-4">
      <button onclick="switchTab('all')" id="tab-all" class="tab-active flex-1 px-4 py-2.5 text-xs font-semibold rounded-xl">
        All <span id="count-all" class="ml-1">0</span>
      </button>
      <button onclick="switchTab('pending')" id="tab-pending" class="flex-1 px-4 py-2.5 text-xs font-semibold text-gray-600 bg-white rounded-xl">
        Pending <span id="count-pending" class="ml-1">0</span>
      </button>
      <button onclick="switchTab('contacted')" id="tab-contacted" class="flex-1 px-4 py-2.5 text-xs font-semibold text-gray-600 bg-white rounded-xl">
        Done <span id="count-contacted" class="ml-1">0</span>
      </button>
      <button onclick="switchTab('callback')" id="tab-callback" class="flex-1 px-4 py-2.5 text-xs font-semibold text-gray-600 bg-white rounded-xl">
        Callback <span id="count-callback" class="ml-1">0</span>
      </button>
    </div>
  </header>

  <!-- Search Bar -->
  <div class="px-5 py-4">
    <div class="relative">
      <input type="text" id="searchInput" placeholder="Search by name, policy, or phone..." 
        class="w-full pl-11 pr-4 py-3 bg-white border border-gray-200 rounded-2xl text-sm">
      <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">üîç</span>
    </div>
  </div>

  <!-- Cards Container -->
  <div id="cardsContainer" class="px-5 pb-6 space-y-4"></div>

  <!-- Disposition Modal -->
  <div id="dispositionModal" class="modal">
    <div class="modal-content bg-white rounded-3xl shadow-2xl mx-4 w-full max-w-md max-h-[90vh] overflow-y-auto">
      <div class="sticky top-0 bg-white rounded-t-3xl px-6 py-5 flex justify-between items-center border-b border-gray-100">
        <h3 class="text-lg font-bold text-gray-800">Update Status</h3>
        <button onclick="closeModal()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-gray-100 text-gray-400 hover:text-gray-600 text-2xl transition-all">√ó</button>
      </div>
      
      <div class="p-6 space-y-5">
        <div id="modalCustomerInfo" class="bg-gradient-to-r from-purple-50 to-blue-50 p-4 rounded-2xl text-sm"></div>
        
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Disposition</label>
          <select id="dispositionSelect" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl text-sm transition-all">
            <option value="">Select status...</option>
            <option value="interested">‚úÖ Interested</option>
            <option value="not_interested">‚ùå Not Interested</option>
            <option value="callback">üìû Callback Required</option>
            <option value="wrong_number">üö´ Wrong Number</option>
            <option value="not_reachable">üìµ Not Reachable</option>
            <option value="already_renewed">‚úîÔ∏è Already Renewed</option>
            <option value="will_think">ü§î Will Think</option>
          </select>
        </div>

        <div id="callbackSection" style="display:none;">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Callback Date & Time</label>
          <input type="datetime-local" id="callbackDateTime" class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl text-sm transition-all">
        </div>

        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
          <textarea id="dispositionNotes" rows="3" placeholder="Add notes about the conversation..." 
            class="w-full px-4 py-3 bg-white border border-gray-200 rounded-xl text-sm transition-all resize-none"></textarea>
        </div>
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">History</label>
          <div id="dispositionHistory" class="max-h-40 overflow-y-auto bg-gray-50 border border-gray-100 rounded-xl p-3 text-xs text-gray-700"></div>
        </div>

        <button onclick="saveDisposition()" class="w-full btn-primary text-white font-semibold py-3.5 rounded-xl">
          Save & Close
        </button>
      </div>
    </div>
  </div>

  <script>
    const data = [
      {sno:1, policy:"90931696", date:"11-Oct-2025", name:"Boya Tribhuvan Teja", phone:"9885562055", plan:"Care Supreme - SI: ‚Çπ17,50,000", dob:"32 yrs", amount:7562, addon:"Unlimited Care - ‚Çπ645"},
      {sno:2, policy:"91075578", date:"12-Oct-2025", name:"Gurparshad Singh", phone:"9501242244", plan:"Care Supreme - SI: ‚Çπ15,00,000 (4 members)", dob:"47, 44, 18, 14 yrs", amount:46627, addon:"Unlimited Care - ‚Çπ2,151"},
      {sno:3, policy:"90931524", date:"13-Oct-2025", name:"Boya Varalakshmi Dev", phone:"9885562055", plan:"Care Supreme - SI: ‚Çπ17,50,000", dob:"65 yrs", amount:105604, addon:"Unlimited Care - ‚Çπ2,796"},
      {sno:4, policy:"90936353", date:"14-Oct-2025", name:"Manu Bai Vishnoi", phone:"9167631985", plan:"Care Supreme - SI: ‚Çπ10,50,000", dob:"59 yrs", amount:19922, addon:"Unlimited Care - ‚Çπ1,704"},
      {sno:5, policy:"91374698", date:"17-Oct-2025", name:"Apurva Gupta", phone:"9535684007", plan:"Care Supreme - SI: ‚Çπ1,25,00,000 (3 members)", dob:"36, 35, 2 yrs", amount:47884, addon:"None"},
      {sno:6, policy:"91178196", date:"17-Oct-2025", name:"Omprakash Sahu", phone:"9893830775", plan:"Care Supreme - SI: ‚Çπ25,00,000 (4 members)", dob:"40, 37, 10, 2 yrs", amount:18158, addon:"Unlimited Care - ‚Çπ1,523"},
      {sno:7, policy:"91270653", date:"20-Oct-2025", name:"Nandala Suresh", phone:"6303951543", plan:"Care Supreme - SI: ‚Çπ35,00,000 (3 members)", dob:"46, 40, 25 yrs", amount:42827, addon:"None"},
      {sno:8, policy:"91290285", date:"21-Oct-2025", name:"Mohammed Shoaib Ul Huq", phone:"9900533007", plan:"Care Supreme - SI: ‚Çπ15,00,000 (3 members)", dob:"62, 56, 19 yrs", amount:48373, addon:"Unlimited Care - ‚Çπ4,183"},
      {sno:9, policy:"91347202", date:"22-Oct-2025", name:"Dipan Banerjee", phone:"8584022210", plan:"Care Supreme - SI: ‚Çπ15,00,000 (2 members)", dob:"59, 58 yrs", amount:32028, addon:"Unlimited Care - ‚Çπ2,737"},
      {sno:10, policy:"91540681", date:"24-Oct-2025", name:"Shashanka Sekhar Nath", phone:"7381252534", plan:"Care Supreme - SI: ‚Çπ10,50,000 (2 members)", dob:"64, 60 yrs", amount:41356, addon:"Unlimited Care - ‚Çπ3,585"},
      {sno:11, policy:"90941094", date:"24-Oct-2025", name:"Mangiiash Anant Ingale", phone:"9860359501", plan:"Care Supreme - SI: ‚Çπ15,00,000 (3 members)", dob:"52, 43, 20 yrs", amount:33753, addon:"None"},
      {sno:12, policy:"91681428", date:"26-Oct-2025", name:"Mrs Santosh", phone:"9760553925", plan:"Care Supreme - SI: ‚Çπ15,00,000", dob:"63 yrs", amount:29694, addon:"Unlimited Care - ‚Çπ2,592"},
      {sno:13, policy:"91425871", date:"26-Oct-2025", name:"Nalla Purendar", phone:"9676315560", plan:"Care Supreme - SI: ‚Çπ25,00,000 (4 members)", dob:"42, 36, 10, 6 yrs", amount:25226, addon:"None"},
      {sno:14, policy:"90934716", date:"27-Oct-2025", name:"Shyam Kishore", phone:"7090555530", plan:"Care Supreme - SI: ‚Çπ25,00,000 (4 members)", dob:"39, 30, 7, 2 yrs", amount:21358, addon:"Unlimited Care - ‚Çπ1,815"},
      {sno:15, policy:"90999914", date:"29-Oct-2025", name:"Redy V S R Krishha Kumari", phone:"9030699991", plan:"Care Supreme - SI: ‚Çπ62,50,000 (2 members)", dob:"42, 11 yrs", amount:18941, addon:"Unlimited Care - ‚Çπ1,248"},
      {sno:16, policy:"91763194", date:"29-Oct-2025", name:"Lakshmi Narasimha Rao Wunnava", phone:"9742544850", plan:"Care Supreme - SI: ‚Çπ25,00,000", dob:"89 yrs", amount:94414, addon:"Unlimited Care - ‚Çπ8,541"},
      {sno:17, policy:"91574188", date:"30-Oct-2025", name:"Dnyaneshwar Hiraman Gaikwad", phone:"9421525223", plan:"Care Supreme - SI: ‚Çπ25,00,000 (2 members)", dob:"65, 60 yrs", amount:38495, addon:"None"},
      {sno:18, policy:"91653682", date:"31-Oct-2025", name:"Shanker Venkata Wunnava", phone:"9742544850", plan:"Care Supreme - SI: ‚Çπ37,50,000 (3 members)", dob:"57, 50, 12 yrs", amount:51552, addon:"Unlimited Care - ‚Çπ3,562"}
    ];

    let dispositions = {};
    const STORAGE_KEY = 'rnl_dispositions';
    let currentTab = 'all';
    let currentPolicy = null;

    function getDisposition(policy) {
      const d = dispositions[policy];
      if (!d) return { status: 'pending', notes: '', callback: null, history: [] };
      if (!Array.isArray(d.history)) d.history = [];
      return d;
    }

    function setDisposition(policy, data) {
      dispositions[policy] = data;
      saveDispositions();
      renderCards();
      updateCounts();
    }

    function loadDispositions() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (raw) {
          dispositions = JSON.parse(raw) || {};
        }
      } catch (e) {
        console.warn('Could not load dispositions from localStorage', e);
        dispositions = {};
      }
    }

    function saveDispositions() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(dispositions));
      } catch (e) {
        console.warn('Could not save dispositions to localStorage', e);
      }
    }

    function getStatusBadge(status) {
      const badges = {
        pending: '<span class="badge bg-gray-100 text-gray-600">‚è≥ Pending</span>',
        interested: '<span class="badge bg-green-50 text-green-600">‚úÖ Interested</span>',
        not_interested: '<span class="badge bg-red-50 text-red-600">‚ùå Not Interested</span>',
        callback: '<span class="badge bg-yellow-50 text-yellow-600">üìû Callback</span>',
        wrong_number: '<span class="badge bg-gray-50 text-gray-500">üö´ Wrong Number</span>',
        not_reachable: '<span class="badge bg-orange-50 text-orange-600">üìµ Not Reachable</span>',
        already_renewed: '<span class="badge bg-blue-50 text-blue-600">‚úîÔ∏è Renewed</span>',
        will_think: '<span class="badge bg-purple-50 text-purple-600">ü§î Thinking</span>'
      };
      return badges[status] || badges.pending;
    }

    function renderCards() {
      const container = document.getElementById("cardsContainer");
      const searchTerm = document.getElementById("searchInput").value.toLowerCase();
      
      container.innerHTML = '';
      
      let filtered = data.filter(item => {
        const disp = getDisposition(item.policy);
        const matchesSearch = !searchTerm || 
          item.name.toLowerCase().includes(searchTerm) ||
          item.policy.includes(searchTerm) ||
          item.phone.includes(searchTerm);
        
        if (!matchesSearch) return false;
        
        if (currentTab === 'all') return true;
        if (currentTab === 'pending') return disp.status === 'pending';
        if (currentTab === 'contacted') return disp.status !== 'pending' && disp.status !== 'callback';
        if (currentTab === 'callback') return disp.status === 'callback';
        
        return true;
      });

      if (filtered.length === 0) {
        container.innerHTML = '<div class="text-center py-16 text-gray-400 text-sm">No records found</div>';
        return;
      }

      filtered.forEach(item => {
        const disp = getDisposition(item.policy);
        const hasCallback = disp.callback && new Date(disp.callback) > new Date();
        
        const card = document.createElement("div");
        card.className = "card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden";

        card.innerHTML = `
          <div class="p-5">
            <div class="flex justify-between items-start mb-4">
              <div class="flex-1">
                <h3 class="font-bold text-gray-800 text-base mb-1 leading-tight">${item.name}</h3>
                <p class="text-xs text-gray-400 font-light">Expiry: ${item.date}</p>
              </div>
              ${getStatusBadge(disp.status)}
            </div>
            
            ${hasCallback ? `
              <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-100 rounded-xl p-3 mb-4 text-xs">
                <div class="flex items-center gap-2">
                  <span class="text-lg">‚è∞</span>
                  <div>
                    <div class="font-semibold text-yellow-800">Callback Scheduled</div>
                    <div class="text-yellow-700 mt-0.5">${new Date(disp.callback).toLocaleString('en-IN', {day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit'})}</div>
                  </div>
                </div>
              </div>
            ` : ''}
            
            <div class="space-y-2 mb-4">
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-400 font-light">Policy</span>
                <span class="text-gray-700 font-medium">${item.policy}</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-400 font-light">Age</span>
                <span class="text-gray-700">${item.dob}</span>
              </div>
              <div class="flex items-center justify-between text-sm">
                <span class="text-gray-400 font-light">Premium</span>
                <span class="text-gray-800 font-bold">‚Çπ${item.amount.toLocaleString("en-IN")}</span>
              </div>
            </div>
            
            <div class="bg-gray-50 rounded-xl p-3 mb-4 text-xs text-gray-600">
              <div class="font-medium text-gray-700 mb-1">Plan Details</div>
              <div class="leading-relaxed">${item.plan}</div>
              ${item.addon !== 'None' ? `<div class="mt-2 text-purple-600 font-medium">Add-on: ${item.addon}</div>` : ''}
            </div>
            
            ${disp.notes ? `
              <div class="bg-blue-50 rounded-xl p-3 mb-4 text-xs">
                <div class="flex gap-2">
                  <span class="text-base">üìù</span>
                  <div class="text-gray-700 leading-relaxed">${disp.notes}</div>
                </div>
              </div>
            ` : ''}
            
            <div class="grid grid-cols-3 gap-2">
              <a href="tel:${item.phone}" 
                class="btn-call text-white font-semibold py-3 px-2 rounded-xl text-xs text-center flex items-center justify-center">
                üìû Call
              </a>
              <a href="https://wa.me/91${item.phone}?text=Hello%20${encodeURIComponent(item.name)},%20this%20is%20regarding%20your%20Care%20Supreme%20policy%20${item.policy}%20expiring%20on%20${encodeURIComponent(item.date)}" 
                target="_blank"
                class="btn-whatsapp text-white font-semibold py-3 px-2 rounded-xl text-xs text-center flex items-center justify-center">
                üí¨ WhatsApp
              </a>
              <button onclick="openModal('${item.policy}')" 
                class="btn-primary text-white font-semibold py-3 px-2 rounded-xl text-xs">
                Update
              </button>
            </div>
            
            <div class="mt-3 text-center">
              <span class="text-xs text-gray-400 font-light">${item.phone}</span>
            </div>
          </div>
        `;
        
        container.appendChild(card);
      });
    }

    function switchTab(tab) {
      currentTab = tab;
      
      document.querySelectorAll('[id^="tab-"]').forEach(t => {
        t.classList.remove('tab-active');
        t.classList.add('text-gray-600', 'bg-white');
      });
      
      document.getElementById(`tab-${tab}`).classList.add('tab-active');
      document.getElementById(`tab-${tab}`).classList.remove('text-gray-600', 'bg-white');
      
      renderCards();
    }

    function updateCounts() {
      const all = data.length;
      const pending = data.filter(item => getDisposition(item.policy).status === 'pending').length;
      const contacted = data.filter(item => {
        const status = getDisposition(item.policy).status;
        return status !== 'pending' && status !== 'callback';
      }).length;
      const callback = data.filter(item => getDisposition(item.policy).status === 'callback').length;
      
      document.getElementById('count-all').textContent = all;
      document.getElementById('count-pending').textContent = pending;
      document.getElementById('count-contacted').textContent = contacted;
      document.getElementById('count-callback').textContent = callback;
    }

    function openModal(policy) {
      currentPolicy = policy;
      const item = data.find(d => d.policy === policy);
      const disp = getDisposition(policy);
      
      document.getElementById('modalCustomerInfo').innerHTML = `
        <div class="font-bold text-gray-800 text-base">${item.name}</div>
        <div class="text-xs text-gray-600 mt-2 font-light">Policy: ${item.policy}</div>
      `;
      
      document.getElementById('dispositionSelect').value = disp.status === 'pending' ? '' : disp.status;
      document.getElementById('dispositionNotes').value = disp.notes || '';
      document.getElementById('callbackDateTime').value = disp.callback || '';

      renderHistory(disp.history || []);
      
      document.getElementById('dispositionModal').classList.add('active');
      
      if (disp.status === 'callback') {
        document.getElementById('callbackSection').style.display = 'block';
      }
    }

    function closeModal() {
      document.getElementById('dispositionModal').classList.remove('active');
      currentPolicy = null;
    }

    function saveDisposition() {
      if (!currentPolicy) return;
      
      const status = document.getElementById('dispositionSelect').value;
      const notes = document.getElementById('dispositionNotes').value;
      const callback = document.getElementById('callbackDateTime').value;
      
      if (!status) {
        alert('Please select a disposition');
        return;
      }
      
      const disp = getDisposition(currentPolicy);
      disp.status = status;
      disp.notes = notes;
      disp.callback = status === 'callback' ? callback : null;
      disp.lastUpdated = new Date().toISOString();

      if (!disp.history) disp.history = [];
      const entry = {
        status,
        notes,
        callback: disp.callback || null,
        timestamp: new Date().toISOString()
      };
      disp.history.push(entry);

      setDisposition(currentPolicy, disp);
      renderHistory(disp.history);
      closeModal();
    }

    function renderHistory(history) {
      const el = document.getElementById('dispositionHistory');
      if (!el) return;
      if (!history || history.length === 0) {
        el.innerHTML = '<div class="text-gray-400">No history yet</div>';
        return;
      }

      const list = history.slice().reverse().map(h => {
        const dt = new Date(h.timestamp);
        const dateStr = dt.toLocaleDateString('en-IN', { day: '2-digit', month: 'short', year: 'numeric' });
        const timeStr = dt.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
        const statusLabel = h.status ? h.status.replace(/_/g, ' ') : 'pending';
        const notes = h.notes ? `<div class="text-gray-700 mt-1">${escapeHtml(h.notes)}</div>` : '';
        const cb = h.callback ? `<div class="text-xs text-yellow-700 mt-1">Callback: ${new Date(h.callback).toLocaleString('en-IN', { day: '2-digit', month: 'short', hour: '2-digit', minute: '2-digit' })}</div>` : '';
        return `
          <div class="border-b border-gray-100 py-2">
            <div class="flex items-center justify-between">
              <div class="font-medium text-gray-700 text-sm">${escapeHtml(statusLabel)}</div>
              <div class="text-xs text-gray-400">${dateStr} ${timeStr}</div>
            </div>
            ${notes}
            ${cb}
          </div>
        `;
      }).join('');

      el.innerHTML = list;
    }

    function escapeHtml(str) {
      if (!str) return '';
      return String(str).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;');
    }

    document.getElementById('dispositionSelect').addEventListener('change', (e) => {
      const section = document.getElementById('callbackSection');
      section.style.display = e.target.value === 'callback' ? 'block' : 'none';
    });

    document.getElementById('searchInput').addEventListener('input', renderCards);

    loadDispositions();
    renderCards();
    updateCounts();
  </script>
</body>
</html>